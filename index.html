<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Alarm Clock & Timer | TimeTells Innovations</title>
  <meta name="description" content="Professional-grade online alarm clock, timer, and stopwatch. Accessible, PWA-ready, and feature-rich. Perfect for productivity, cooking, workouts, and sleep management.">
  <meta name="keywords" content="alarm clock, timer, stopwatch, PWA, accessible, professional, productivity">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4caf50">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://www.timetellsinnovations.com/favicon.png">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Professional Alarm Clock & Timer">
  <meta property="og:description" content="Professional-grade alarm clock with accessibility features and PWA support">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://www.timetellsinnovations.com/og-image.png">
  
  <style>
    /* Root variables for theme */
    :root {
      --primary-color: #4caf50;
      --primary-dark: #43a047;
      --secondary-color: #2196f3;
      --danger-color: #f44336;
      --warning-color: #ff9800;
      --success-color: #4caf50;
      
      --bg-light: #ffffff;
      --bg-dark: #121212;
      --text-light: #f0f0f0;
      --text-dark: #333333;
      --border-light: #e0e0e0;
      --border-dark: #424242;
      --surface-light: #f8f9fa;
      --surface-dark: #1e1e1e;
      
      --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.1);
      --shadow-dark: 0 2px 10px rgba(255, 255, 255, 0.1);
      
      --transition: all 0.3s ease;
      --border-radius: 8px;
      --spacing-unit: 1rem;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.6;
      transition: var(--transition);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .dark-mode {
      background: var(--bg-dark);
      color: var(--text-light);
    }

    /* Skip to main content for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--primary-color);
      color: white;
      padding: 8px;
      text-decoration: none;
      border-radius: 4px;
      z-index: 1000;
    }

    .skip-link:focus {
      top: 6px;
    }

    /* Header */
    header {
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-unit);
      text-align: center;
      box-shadow: var(--shadow-light);
    }

    .dark-mode header {
      box-shadow: var(--shadow-dark);
    }

    h1 {
      margin: 0;
      font-size: 2.5rem;
      font-weight: 600;
    }

    /* Main content */
    main {
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-unit);
      width: 100%;
    }

    .section {
      background: var(--surface-light);
      border: 1px solid var(--border-light);
      border-radius: var(--border-radius);
      padding: calc(var(--spacing-unit) * 1.5);
      margin-bottom: var(--spacing-unit);
      box-shadow: var(--shadow-light);
      transition: var(--transition);
    }

    .dark-mode .section {
      background: var(--surface-dark);
      border-color: var(--border-dark);
      box-shadow: var(--shadow-dark);
    }

    .section:focus-within {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    h2 {
      margin-top: 0;
      color: var(--primary-color);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Time displays */
    .time-display {
      font-family: 'Courier New', monospace;
      font-size: 3rem;
      font-weight: 700;
      text-align: center;
      padding: var(--spacing-unit);
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: var(--border-radius);
      margin: var(--spacing-unit) 0;
      color: var(--primary-color);
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dark-mode .time-display {
      background: var(--bg-dark);
      border-color: var(--border-dark);
    }

    /* Form controls */
    .form-group {
      margin-bottom: var(--spacing-unit);
    }

    .form-row {
      display: flex;
      gap: var(--spacing-unit);
      margin-bottom: var(--spacing-unit);
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-dark);
    }

    .dark-mode label {
      color: var(--text-light);
    }

    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border-light);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
      background: var(--bg-light);
      color: var(--text-dark);
    }

    .dark-mode input[type="number"],
    .dark-mode input[type="text"],
    .dark-mode select {
      background: var(--bg-dark);
      border-color: var(--border-dark);
      color: var(--text-light);
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
      min-width: 120px;
    }

    .btn:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #1976d2;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover:not(:disabled) {
      background: #d32f2f;
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* Status and notifications */
    .status {
      padding: var(--spacing-unit);
      border-radius: var(--border-radius);
      margin: var(--spacing-unit) 0;
      font-weight: 500;
      text-align: center;
    }

    .status-info {
      background: #e3f2fd;
      color: #1976d2;
      border: 1px solid #bbdefb;
    }

    .status-success {
      background: #e8f5e8;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }

    .status-warning {
      background: #fff3e0;
      color: #f57c00;
      border: 1px solid #ffcc02;
    }

    .dark-mode .status-info {
      background: rgba(33, 150, 243, 0.1);
      border-color: rgba(33, 150, 243, 0.3);
    }

    .dark-mode .status-success {
      background: rgba(76, 175, 80, 0.1);
      border-color: rgba(76, 175, 80, 0.3);
    }

    .dark-mode .status-warning {
      background: rgba(255, 152, 0, 0.1);
      border-color: rgba(255, 152, 0, 0.3);
    }

    /* Alarm lists */
    .alarm-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .alarm-item {
      background: var(--surface-light); /* Changed to surface-light for consistency */
      border: 1px solid var(--border-light);
      border-radius: var(--border-radius);
      padding: var(--spacing-unit);
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .dark-mode .alarm-item {
      background: var(--surface-dark); /* Changed to surface-dark for consistency */
      border-color: var(--border-dark);
    }

    .alarm-info {
      flex: 1;
      min-width: 200px;
    }

    .alarm-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* Custom notification */
    .notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        max-width: 300px;
        pointer-events: none; /* Allows clicks to pass through */
    }

    .notification {
      background: var(--primary-color);
      color: white;
      padding: var(--spacing-unit);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-light);
      margin-bottom: 10px; /* Space between multiple notifications */
      animation: slideIn 0.3s ease forwards, fadeOut 0.5s ease 2.5s forwards; /* Added fadeOut */
      pointer-events: auto; /* Re-enable clicks for the notification itself */
      opacity: 0; /* Start hidden */
    }

    .notification.success {
      background: var(--success-color);
    }

    .notification.warning {
      background: var(--warning-color);
    }

    .notification.danger {
      background: var(--danger-color);
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }

    /* Dark mode toggle */
    .theme-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      transition: var(--transition);
      z-index: 100;
      box-shadow: var(--shadow-light);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    .theme-toggle:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 4px;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
      }
      
      .time-display {
        font-size: 2rem;
      }
      
      .alarm-item {
        flex-direction: column;
        align-items: stretch;
      }
      
      .alarm-actions {
        justify-content: center;
      }
      
      h1 {
        font-size: 2rem;
      }
    }

    /* Loading state */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Focus indicators for accessibility */
    .focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    /* Screen reader only content */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Custom Alert Modal Styling (re-integrated from previous version) */
    .custom-alert-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .custom-alert-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .custom-alert-content {
      background: var(--modal-content-bg);
      color: var(--modal-text);
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      text-align: center;
      max-width: 90%;
      width: 400px;
      transform: scale(0.9);
      transition: transform 0.3s;
    }

    .custom-alert-overlay.show .custom-alert-content {
      transform: scale(1);
    }

    .custom-alert-content h3 {
      margin-top: 0;
      font-size: 1.5rem;
      color: var(--primary-color); /* Changed to primary-color */
    }

    .custom-alert-content p {
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
    }

    .custom-alert-content button {
      width: auto;
      padding: 0.75rem 2rem;
      margin: 0 auto;
      background: var(--primary-color); /* Consistent button styling */
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
    }
    .custom-alert-content button:hover {
        background: var(--primary-dark);
    }
  </style>
</head>
<body>
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <header>
    <h1>Professional Alarm Clock & Timer</h1>
  </header>

  <main id="main-content">
    <!-- Live Clock Section -->
    <section class="section" aria-labelledby="live-clock-heading">
      <h2 id="live-clock-heading">🕐 Live Clock</h2>
      <div class="time-display" id="liveClock" role="timer" aria-live="polite" aria-atomic="true">
        <span class="sr-only">Current time: </span>
        --:--:--
      </div>
    </section>

    <!-- Timer Section -->
    <section class="section" aria-labelledby="timer-heading">
      <h2 id="timer-heading">⏱️ Countdown Timer</h2>
      
      <div class="form-group">
        <div class="form-row">
          <div>
            <label for="timerMinutes">Minutes (0-999)</label>
            <input type="number" id="timerMinutes" min="0" max="999" value="0" 
                   aria-describedby="timer-help">
          </div>
          <div>
            <label for="timerSeconds">Seconds (0-59)</label>
            <input type="number" id="timerSeconds" min="0" max="59" value="0" 
                   aria-describedby="timer-help">
          </div>
        </div>
        <div id="timer-help" class="sr-only">
          Enter the desired countdown time in minutes and seconds
        </div>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-primary" id="startTimerBtn" 
                aria-describedby="timer-start-help">
          <span id="timer-btn-text">Start Timer</span>
        </button>
        <button type="button" class="btn btn-danger" id="stopTimerBtn" 
                aria-describedby="timer-stop-help" disabled>
          Stop Timer
        </button>
        <button type="button" class="btn btn-secondary" id="pauseTimerBtn" 
                aria-describedby="timer-pause-help" disabled>
          Pause Timer
        </button>
      </div>
      
      <div id="timer-start-help" class="sr-only">Starts the countdown timer</div>
      <div id="timer-stop-help" class="sr-only">Stops and resets the timer</div>
      <div id="timer-pause-help" class="sr-only">Pauses or resumes the timer</div>

      <div class="time-display" id="timerDisplay" role="timer" aria-live="polite" aria-atomic="true">
        <span class="sr-only">Timer: </span>
        00:00
      </div>
      
      <div class="status status-info" id="timerStatus" role="status" aria-live="polite">
        Ready to start timer
      </div>
    </section>

    <!-- Alarm Section -->
    <section class="section" aria-labelledby="alarm-heading">
      <h2 id="alarm-heading">⏰ Alarm Clock</h2>
      
      <div class="form-group">
        <div class="form-row">
          <div>
            <label for="alarmHour">Hour</label>
            <select id="alarmHour" aria-describedby="alarm-help"></select>
          </div>
          <div>
            <label for="alarmMinute">Minute</label>
            <select id="alarmMinute" aria-describedby="alarm-help"></select>
          </div>
        </div>
        <div id="alarm-help" class="sr-only">
          Set the time for your alarm using hour and minute dropdowns.
        </div>
      </div>

      <button type="button" class="btn btn-primary" id="setAlarmBtn">
        Set Alarm
      </button>
      
      <div class="status status-info" id="alarmStatus" role="status" aria-live="polite">
        No alarms set
      </div>
      
      <div>
        <h3>Active Alarms</h3>
        <ul id="alarmList" class="alarm-list" role="list" aria-live="polite">
          <!-- Dynamic alarm items will be inserted here -->
        </ul>
      </div>
      
      <div>
        <h3>Alarm History</h3>
        <ul id="alarmHistory" class="alarm-list" role="list">
          <!-- Dynamic history items will be inserted here -->
        </ul>
      </div>
    </section>

    <!-- Settings Section -->
    <section class="section" aria-labelledby="settings-heading">
      <h2 id="settings-heading">🔊 Settings</h2>
      
      <div class="form-group">
        <label for="alarmTone">Alarm Sound</label>
        <select id="alarmTone" aria-describedby="sound-help">
          <option value="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg">Default Alarm</option>
          <option value="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg">Digital Watch</option>
          <option value="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">Short Beep</option>
          <option value="https://actions.google.com/sounds/v1/alarms/bell_chime.ogg">Bell Chime</option>
          <option value="https://actions.google.com/sounds/v1/alarms/alarm_clock_02.ogg">Classic Alarm</option>
        </select>
        <div id="sound-help" class="sr-only">
          Choose your preferred alarm sound
        </div>
      </div>
      
      <div class="form-group">
        <label for="volumeControl">Volume</label>
        <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.7" 
               aria-describedby="volume-help">
        <div id="volume-help" class="sr-only">
          Adjust the alarm volume from 0 to 100 percent
        </div>
      </div>
      
      <div class="btn-group">
        <button type="button" class="btn btn-secondary" id="testSoundBtn">
          Test Sound
        </button>
        <button type="button" class="btn btn-secondary" id="resetSettingsBtn">
          Reset Settings
        </button>
      </div>
    </section>
  </main>

  <!-- Theme toggle button -->
  <button type="button" class="theme-toggle" id="themeToggle" 
          aria-label="Toggle dark mode" title="Toggle dark mode">
    🌙
  </button>

  <!-- Audio elements for different sounds -->
  <audio id="alarmAudio" preload="auto">
    <!-- Source will be set dynamically via JavaScript -->
  </audio>

  <!-- New audio element for countdown beep -->
  <audio id="countdownShortBeep" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>

  <!-- Custom Alert Modal HTML (re-integrated) -->
  <div id="customAlertOverlay" class="custom-alert-overlay">
    <div class="custom-alert-content">
      <h3 id="alertTitle">Notification</h3>
      <p id="alertMessage">This is a custom alert.</p>
      <button class="btn btn-primary" onclick="hideAlert()">Dismiss</button>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notificationContainer" class="notification-container"></div>

  <script>
    // --- DOM Element References ---
    const liveClockDisplay = document.getElementById('liveClock');

    const timerMinutesInput = document.getElementById('timerMinutes');
    const timerSecondsInput = document.getElementById('timerSeconds');
    const startTimerBtn = document.getElementById('startTimerBtn');
    const stopTimerBtn = document.getElementById('stopTimerBtn');
    const pauseTimerBtn = document.getElementById('pauseTimerBtn');
    const timerBtnText = document.getElementById('timer-btn-text');
    const timerDisplay = document.getElementById('timerDisplay');
    const timerStatus = document.getElementById('timerStatus');

    const alarmHourSelect = document.getElementById('alarmHour'); 
    const alarmMinuteSelect = document.getElementById('alarmMinute'); 
    const setAlarmBtn = document.getElementById('setAlarmBtn');
    const alarmStatus = document.getElementById('alarmStatus');
    const alarmList = document.getElementById('alarmList');
    const alarmHistory = document.getElementById('alarmHistory');

    const alarmToneSelect = document.getElementById('alarmTone');
    const volumeControl = document.getElementById('volumeControl');
    const testSoundBtn = document.getElementById('testSoundBtn');
    const resetSettingsBtn = document.getElementById('resetSettingsBtn');
    const alarmAudio = document.getElementById('alarmAudio');
    const countdownShortBeep = document.getElementById('countdownShortBeep'); 

    const themeToggleBtn = document.getElementById('themeToggle');
    const customAlertOverlay = document.getElementById('customAlertOverlay');
    const alertTitle = document.getElementById('alertTitle');
    const alertMessage = document.getElementById('alertMessage');
    const notificationContainer = document.getElementById('notificationContainer');

    // --- Global Variables ---
    let timerInterval;
    let timerTotalSeconds = 0;
    let timerIsPaused = false;
    let activeAlarms = []; 
    let notificationTimeout;

    // --- Utility Functions ---

    /**
     * Displays a custom alert modal.
     * @param {string} title - The title of the alert.
     * @param {string} message - The message content of the alert.
     */
    function showAlert(title, message) {
      alertTitle.textContent = title;
      alertMessage.textContent = message;
      customAlertOverlay.classList.add('show');
      // Pause alarm sound if it's playing when alert shows
      alarmAudio.pause();
      alarmAudio.currentTime = 0;
    }

    /**
     * Hides the custom alert modal.
     */
    function hideAlert() {
      customAlertOverlay.classList.remove('show');
      alarmAudio.pause(); // Ensure alarm sound is stopped
      alarmAudio.currentTime = 0; // Reset audio playback position
    }

    /**
     * Shows a transient notification.
     * @param {string} message - The message to display.
     * @param {string} type - 'success', 'warning', 'danger', or 'info' (default).
     * @param {number} duration - Duration in milliseconds (default: 3000).
     */
    function showNotification(message, type = 'info', duration = 3000) {
        const notificationDiv = document.createElement('div');
        notificationDiv.className = `notification ${type}`;
        notificationDiv.textContent = message;
        notificationContainer.appendChild(notificationDiv);

        // Remove the notification after the duration
        setTimeout(() => {
            notificationDiv.remove();
        }, duration);
    }

    // --- Live Clock Functionality ---
    /**
     * Updates the live clock display every second.
     */
    function updateLiveClock() {
      const now = new Date();
      liveClockDisplay.textContent = now.toLocaleTimeString();
    }

    // Initialize and start live clock
    updateLiveClock();
    setInterval(updateLiveClock, 1000);

    // --- Countdown Timer Functionality ---

    /**
     * Updates the timer display with formatted minutes and seconds.
     * @param {number} totalSeconds - The total seconds remaining.
     */
    function updateTimerDisplay(totalSeconds) {
      const min = Math.floor(totalSeconds / 60);
      const sec = totalSeconds % 60;
      timerDisplay.textContent = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
    }

    /**
     * Enables/disables timer control buttons.
     * @param {boolean} running - True if timer is running/paused, false otherwise.
     */
    function setTimerButtonsState(running) {
        startTimerBtn.disabled = running && !timerIsPaused; // Disable start if running and not paused
        stopTimerBtn.disabled = !running;
        pauseTimerBtn.disabled = !running;
        timerBtnText.textContent = timerIsPaused ? 'Resume Timer' : 'Start Timer';
    }

    /**
     * Starts or resumes the countdown timer.
     */
    function startTimer() {
      clearInterval(timerInterval); // Clear any previous timer

      if (!timerIsPaused) {
        // Only read inputs if not resuming from a pause
        let minutes = parseInt(timerMinutesInput.value) || 0;
        let seconds = parseInt(timerSecondsInput.value) || 0;
        timerTotalSeconds = minutes * 60 + seconds;
      }

      if (timerTotalSeconds <= 0) {
        showAlert("Timer Error", "Please enter a valid time for the timer.");
        timerStatus.textContent = "Ready to start timer";
        setTimerButtonsState(false);
        return;
      }

      timerIsPaused = false;
      setTimerButtonsState(true);
      timerStatus.textContent = "Timer running...";
      showNotification("Timer started!", "success");

      timerInterval = setInterval(() => {
        if (timerTotalSeconds <= 0) {
          clearInterval(timerInterval);
          alarmAudio.play(); // Main alarm for completion
          showAlert("Timer Finished!", "Your countdown timer has ended!");
          timerDisplay.textContent = "00:00";
          timerStatus.textContent = "Timer finished!";
          setTimerButtonsState(false);
          timerMinutesInput.value = 0; // Reset inputs
          timerSecondsInput.value = 0;
        } else {
          // Play a short beep for the last 3 seconds
          if (timerTotalSeconds <= 3 && timerTotalSeconds > 0) {
            countdownShortBeep.currentTime = 0; // Rewind to start
            countdownShortBeep.play().catch(e => console.warn("Could not play countdown beep:", e));
          }
          timerTotalSeconds--;
          updateTimerDisplay(timerTotalSeconds);
        }
      }, 1000);

      updateTimerDisplay(timerTotalSeconds); // Initial display update
    }

    /**
     * Stops and resets the countdown timer.
     */
    function stopTimer() {
      clearInterval(timerInterval);
      timerTotalSeconds = 0;
      timerIsPaused = false;
      updateTimerDisplay(0);
      timerStatus.textContent = "Timer stopped and reset.";
      setTimerButtonsState(false);
      timerMinutesInput.value = 0; // Reset inputs
      timerSecondsInput.value = 0;
      showNotification("Timer stopped.", "danger");
    }

    /**
     * Pauses or resumes the countdown timer.
     */
    function pauseTimer() {
      if (timerIsPaused) {
        startTimer(); // Resume
        timerStatus.textContent = "Timer resumed...";
        showNotification("Timer resumed.", "info");
      } else {
        clearInterval(timerInterval); // Pause
        timerIsPaused = true;
        timerStatus.textContent = "Timer paused.";
        setTimerButtonsState(true); // Update button text to "Resume"
        showNotification("Timer paused.", "warning");
      }
    }

    // Attach event listeners for timer buttons
    startTimerBtn.addEventListener('click', startTimer);
    stopTimerBtn.addEventListener('click', stopTimer);
    pauseTimerBtn.addEventListener('click', pauseTimer);

    // --- Alarm Clock Functionality ---

    /**
     * Populates the hour and minute dropdowns.
     */
    function populateAlarmTimeDropdowns() {
        // Populate hours (00-23)
        for (let i = 0; i < 24; i++) {
            const option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.textContent = i.toString().padStart(2, '0');
            alarmHourSelect.appendChild(option);
        }

        // Populate minutes (00-59)
        for (let i = 0; i < 60; i++) {
            const option = document.createElement('option');
            option.value = i.toString().padStart(2, '0');
            option.textContent = i.toString().padStart(2, '0');
            alarmMinuteSelect.appendChild(option);
        }

        // Set initial selection to current time for convenience
        const now = new Date();
        alarmHourSelect.value = now.getHours().toString().padStart(2, '0');
        alarmMinuteSelect.value = now.getMinutes().toString().padStart(2, '0');
    }

    /**
     * Sets a new alarm based on the selected hour and minute.
     * Manages multiple alarms.
     */
    function setAlarm() {
      const selectedHour = alarmHourSelect.value;
      const selectedMinute = alarmMinuteSelect.value;

      if (!selectedHour || !selectedMinute) {
        showAlert("Error", "Please select both an hour and a minute for the alarm.");
        return;
      }

      const now = new Date();
      const alarmDate = new Date();
      alarmDate.setHours(parseInt(selectedHour), parseInt(selectedMinute), 0, 0);

      // If the alarm time is in the past, set it for the next day
      if (alarmDate < now) {
        alarmDate.setDate(alarmDate.getDate() + 1);
      }

      const delay = alarmDate - now; // Delay in milliseconds

      const alarmId = crypto.randomUUID(); // Generate a unique ID for the alarm

      // Create the alarm list item
      const alarmItem = document.createElement('li');
      alarmItem.id = `alarm-${alarmId}`; // Assign a unique ID to the list item
      alarmItem.className = 'alarm-item';
      alarmItem.setAttribute('role', 'listitem');
      alarmItem.innerHTML = `
        <span class="alarm-info">
          ⏰ Alarm set for ${alarmDate.toLocaleTimeString()}
        </span>
        <div class="alarm-actions">
          <button type="button" class="btn btn-secondary" onclick="snoozeAlarm('${alarmId}', 5)">
            Snooze (5m)
          </button>
          <button type="button" class="btn btn-danger" onclick="cancelAlarm('${alarmId}')">
            Cancel
          </button>
        </div>
      `;
      alarmList.appendChild(alarmItem);

      // Set the timeout for the alarm
      const timeoutId = setTimeout(() => {
        alarmAudio.play().catch(e => console.error("Error playing alarm sound:", e)); // Added catch for play()
        showAlert("Alarm Ringing!", `⏰ It's ${alarmDate.toLocaleTimeString()}!`); // Show custom alert
        logAlarmHistory(alarmDate.toLocaleTimeString()); // Log to history
        cancelAlarm(alarmId, false); // Cancel the alarm from the list, but don't clear status if others exist
      }, delay);

      // Store the alarm details in the activeAlarms array
      activeAlarms.push({
        id: alarmId,
        hour: selectedHour,
        minute: selectedMinute,
        date: alarmDate,
        timeoutId: timeoutId,
        element: alarmItem // Reference to the DOM element
      });

      updateAlarmStatus(); // Update the status message
      showNotification("Alarm set successfully!", "success");
    }

    /**
     * Cancels a specific alarm.
     * @param {string} alarmId - The ID of the alarm to cancel.
     * @param {boolean} [updateStatus=true] - Whether to update the alarm status message.
     */
    function cancelAlarm(alarmId, updateStatus = true) {
      const index = activeAlarms.findIndex(alarm => alarm.id === alarmId);

      if (index !== -1) {
        const alarm = activeAlarms[index];
        clearTimeout(alarm.timeoutId); // Clear the associated timeout
        alarm.element.remove(); // Remove the list item from the DOM
        activeAlarms.splice(index, 1); // Remove the alarm from the array
        showNotification("Alarm cancelled.", "danger");
      }

      if (updateStatus) {
        updateAlarmStatus(); // Update the status message
      }
    }

    /**
     * Snoozes a specific alarm for a given number of minutes.
     * @param {string} alarmId - The ID of the alarm to snooze.
     * @param {number} minutes - The number of minutes to snooze.
     */
    function snoozeAlarm(alarmId, minutes) {
      const index = activeAlarms.findIndex(alarm => alarm.id === alarmId);

      if (index !== -1) {
        const alarm = activeAlarms[index];
        clearTimeout(alarm.timeoutId); // Clear the current alarm timeout

        const snoozeDate = new Date(Date.now() + minutes * 60000); // Calculate new snooze time
        alarm.date = snoozeDate; // Update the alarm's date
        
        // Update stored hour and minute for the snoozed alarm
        alarm.hour = snoozeDate.getHours().toString().padStart(2, '0');
        alarm.minute = snoozeDate.getMinutes().toString().padStart(2, '0');

        const delay = snoozeDate - new Date(); // Recalculate delay

        // Update the list item's text to show new snooze time
        alarm.element.querySelector('.alarm-info').textContent =
          `⏰ Alarm snoozed to ${snoozeDate.toLocaleTimeString()}`;

        // Set a new timeout for the snoozed alarm
        alarm.timeoutId = setTimeout(() => {
          alarmAudio.play().catch(e => console.error("Error playing snoozed alarm sound:", e)); // Added catch for play()
          showAlert("Alarm Ringing!", `⏰ It's ${snoozeDate.toLocaleTimeString()}! (Snoozed)`);
          logAlarmHistory(snoozeDate.toLocaleTimeString());
          cancelAlarm(alarm.id, false); // Cancel the alarm from the list
        }, delay);

        updateAlarmStatus(); // Update status
        showNotification(`Alarm snoozed for ${minutes} minutes.`, "warning");
      }
    }

    /**
     * Updates the alarm status message based on the number of active alarms.
     */
    function updateAlarmStatus() {
      if (activeAlarms.length === 0) {
        alarmStatus.textContent = "No alarms set";
        alarmStatus.className = "status status-info";
      } else if (activeAlarms.length === 1) {
        alarmStatus.textContent = "1 alarm set";
        alarmStatus.className = "status status-success";
      } else {
        alarmStatus.textContent = `${activeAlarms.length} alarms set`;
        alarmStatus.className = "status status-success";
      }
    }

    /**
     * Logs the time an alarm rang to the alarm history list.
     * @param {string} time - The time the alarm rang.
     */
    function logAlarmHistory(time) {
      const entry = document.createElement('li');
      entry.className = 'alarm-item';
      entry.setAttribute('role', 'listitem');
      entry.textContent = `✅ Alarm rang at ${time}`;
      alarmHistory.prepend(entry); // Add to the top of the history list
    }

    // Attach event listener for Set Alarm button
    setAlarmBtn.addEventListener('click', setAlarm);

    // --- Settings Functionality ---

    /**
     * Changes the alarm sound based on the selected option.
     */
    function changeAlarmSound() {
      const selectedUrl = alarmToneSelect.value;
      alarmAudio.src = selectedUrl;
      alarmAudio.load(); // Reload the audio element to apply new source
      showNotification("Alarm sound changed.", "info");
    }

    /**
     * Sets the volume of the alarm sound.
     */
    function setAlarmVolume() {
      alarmAudio.volume = parseFloat(volumeControl.value);
      countdownShortBeep.volume = parseFloat(volumeControl.value); // Apply volume to beep sound too
    }

    /**
     * Tests the currently selected alarm sound.
     */
    function testAlarmSound() {
      alarmAudio.play().catch(e => {
        console.error("Error playing sound:", e);
        showAlert("Playback Error", "Could not play sound. Please ensure browser allows autoplay or user interaction first.");
      });
      showNotification("Testing alarm sound...", "info");
    }

    /**
     * Resets settings to default values.
     */
    function resetSettings() {
      alarmToneSelect.value = "https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg";
      volumeControl.value = 0.7;
      changeAlarmSound(); // Apply default sound
      setAlarmVolume(); // Apply default volume
      showNotification("Settings reset to default.", "info");
    }

    // Attach event listeners for settings
    alarmToneSelect.addEventListener('change', changeAlarmSound);
    volumeControl.addEventListener('input', setAlarmVolume);
    testSoundBtn.addEventListener('click', testAlarmSound); 
    resetSettingsBtn.addEventListener('click', resetSettings);

    // Initialize settings on load
    setAlarmVolume(); // Set initial volume
    changeAlarmSound(); // Set initial sound

    // --- Dark Mode Toggle Functionality ---
    /**
     * Toggles dark mode on and off.
     */
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      themeToggleBtn.textContent = isDarkMode ? '☀️' : '🌙'; // Change icon
      // Store preference in localStorage
      localStorage.setItem('darkMode', isDarkMode);
      showNotification(`Dark mode ${isDarkMode ? 'enabled' : 'disabled'}.`, "info");
    }

    // Check for dark mode preference on load
    function loadDarkModePreference() {
        const savedMode = localStorage.getItem('darkMode');
        if (savedMode === 'true') {
            document.body.classList.add('dark-mode');
            themeToggleBtn.textContent = '☀️';
        } else {
            themeToggleBtn.textContent = '🌙';
        }
    }

    // Attach event listener for theme toggle
    themeToggleBtn.addEventListener('click', toggleDarkMode);

    // Initial load of dark mode preference
    loadDarkModePreference();

    // --- Initial States and Setup ---
    populateAlarmTimeDropdowns(); // Call this to populate dropdowns on load
    updateAlarmStatus(); // Update alarm status on load
    setTimerButtonsState(false); // Set initial timer button states
  </script>
</body>
</html>
